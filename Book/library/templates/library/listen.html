{% extends 'library/base.html' %}
{% load static %}

{% block title %}{{ book.title }} - استمع{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book-detail.css' %}">
{% endblock %}

{% block content %}
<div class="book-detail-container">
    <div class="book-container">
        <div class="book-cover">
            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
        </div>
        <div class="book-content">
            <div class="book-header">
                <h1>{{ book.title }}</h1>
                <p class="author">{{ book.author }}</p>
            </div>
            <div class="book-meta-grid">
                <div class="meta-item">
                    <span class="meta-label">مدة الاستماع:</span>
                    <span class="meta-value">01:15:00</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">عدد الصفحات:</span>
                    <span class="meta-value">83</span>
                </div>
            </div>
            <p class="story-category">{{ book.category.name }}</p>
            <div class="book-actions">
                <a href="{{ book.audio_file.url }}" class="action-btn listen-btn" download>تحميل</a>
                <a href="{% url 'description' book.id %}" class="action-btn read-btn">اقرأ</a>
            </div>
        </div>
    </div>

    <div class="book-description">
        <h2>وصف الكتاب</h2>
        <p>{{ book.description }}</p>
    </div>

    <!-- Audio Player -->
    <div class="audio-player">
        <div class="player-header">
            <div class="player-info">
                <h3 class="player-title">{{ book.title }}</h3>
                <p class="player-author">{{ book.author }}</p>
                <p class="player-year">{{ book.created_at|date:"Y" }}</p>
            </div>
            <div class="player-cover">
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
            </div>
        </div>

        <div class="player-controls">
            <button class="control-btn" title="إعجاب">
                <svg viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </button>
            <button class="control-btn" title="مشاركة">
                <svg viewBox="0 0 24 24">
                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                </svg>
            </button>
        </div>

        <div class="player-main-controls">
            <button class="control-btn" id="prevBtn" title="السابق">
                <svg viewBox="0 0 24 24">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                </svg>
            </button>
            <button class="control-btn play-btn" id="playBtn" title="تشغيل / إيقاف">
                <svg class="play-icon" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <svg class="pause-icon" viewBox="0 0 24 24" style="display: none;">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                </svg>
            </button>
            <button class="control-btn" id="nextBtn" title="التالي">
                <svg viewBox="0 0 24 24">
                    <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                </svg>
            </button>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>
    </div>

    <!-- Hidden Audio Element -->
    <audio id="audioPlayer" src="{{ book.audio_file.url }}"></audio>

    <!-- Comments Section -->
    <div class="comments-section">
        <h3>التعليقات</h3>
        <div class="comment-form">
            <input type="text" placeholder="اكتب تعليقك...">
            <button type="submit">إرسال</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/audio-player.js' %}"></script>
{% endblock %}
